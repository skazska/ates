# Таск-трекер

## Таск-трекер должен быть отдельным дашбордом
Q: task-tracker board
### Таск-трекер должен быть доступен всем сотрудникам компании UberPopug Inc.
A: user: admin, manager, employee
P: task-tracker board access: user: authorized
### Авторизация в таск-трекере должна выполняться через общий сервис авторизации UberPopug Inc (у нас там инновационная система авторизации на основе формы клюва).
EXT: auth
### В таск-трекере должны быть только задачи. Проектов, скоупов и спринтов нет, потому что они не умещаются в голове попуга.
M: task[]


## Новые таски может создавать кто угодно (администратор, начальник, разработчик, менеджер и любая другая роль).
C: Create task
A: user: admin, manager, employee
E: Task created (uuid)
E: Task changed (uuid, status, assignee)
### У задачи должны быть описание, статус (выполнена или нет) и рандомно выбранный попуг (кроме менеджера и администратора), на которого заассайнена задача.
M: task: status(assigned, closed), assignee

## Менеджеры или администраторы должны иметь кнопку «заассайнить задачи», которая возьмёт все открытые задачи и рандомно заассайнит каждую на любого из сотрудников (кроме менеджера и администратора) . Не успел закрыть задачу до реассайна — сорян, делай следующую.
C: Assign all
A: user: admin, manager
E: Task changed (uuid, status, assignee)
### Ассайнить задачу можно на кого угодно (кроме менеджера и администратора), это может быть любой существующий аккаунт из системы.
P: task-assignee: users except(admin, manager)
### Ассайнить задачу на нового попуга, можно только кнопкой «заассайнить задачи», других вариантов нет
P: change assignee by Assign all command only
### При нажатии кнопки «заассайнить задачи» все текущие не закрытые задачи должны быть случайным образом перетасованы между каждым аккаунтом в системе
P: Assign all command reassigns all tasks assignies except completed
### Мы не заморачиваемся на ограничение по нажатию на кнопку «заассайнить задачи». Её можно нажимать хоть каждую секунду.
P
### На одного сотрудника может выпасть любое количество новых задач, может выпасть ноль, а может и 10.
P
### Создать задачу не заасайненую на пользователя нельзя. Т.е. любая задача должна иметь попуга, который ее делает
P: task assignee - not null

## Каждый сотрудник должен иметь возможность видеть в отдельном месте список заассайненных на него задач.
Q: own-tasks board
A: roles: employee
P: own-tasks board access: assignee
M: task[]
## Каждый сотрудник должен иметь возможность отметить задачу выполненной.
C: Complete task
A: roles: employee
P: Complete task access: assignee
E: Task changed (uuid, status, assignee)

# Аккаунтинг: кто сколько денег заработал

## Аккаунтинг должен быть в отдельном дашборде 
Q: accounting board
A: roles: admin, manager, employee
### Аккаунтинг должен быть доступным только для администраторов и бухгалтеров.
P: accounting board full access: roles: admin, manager

### у обычных попугов доступ к аккаунтингу тоже должен быть. Но только к информации о собственных счетах (аудит лог + текущий баланс).
P: accounting board own account access: roles: employee

### У админов и бухгалтеров должен быть доступ к общей статистике по деньгами заработанным (количество заработанных топ-менеджментом за сегодня денег + статистика по дням).
M: top_managers_income: a day
### Авторизация в дешборде аккаунтинга должна выполняться через общий сервис аутентификации UberPopug Inc.
P: accounting board access: users: authorized
EXT: auth

## У каждого из сотрудников должен быть свой счёт, который показывает, сколько за сегодня он получил денег.
M: employee: balance
## У счёта должен быть аудитлог того, за что были списаны или начислены деньги, с подробным описанием каждой из задач.
M: balance: log

## Расценки:
### цены на задачу определяется единоразово, в момент появления в системе (можно с минимальной задержкой)
цены рассчитываются без привязки к сотруднику
M: task-prices: add, sub
C: Set price
A: Task created
E: Price set

#### формула, которая говорит сколько списать денег с сотрудника при ассайне задачи — rand(-10..-20)$
C: balance add
A: Task changed
P: status is not completed
E: Balance changed(amount, current)

#### формула, которая говорит сколько начислить денег сотруднику для выполненой задачи — rand(20..40)$
C: balance sub
A: Task changed
P: status is completed
E: Balance changed(employee, amount, current)

деньги списываются сразу после ассайна на сотрудника, а начисляются после выполнения задачи.

отрицательный баланс переносится на следующий день. Единственный способ его погасить - закрыть достаточное количество задач в течение дня.

## Дашборд должен выводить количество заработанных топ-менеджментом за сегодня денег.
a) т.е. сумма всех закрытых и заасайненых задач за день с противоположным знаком: (sum(completed task amount) + sum(assigned task fee)) * -1
M: top_managers_income: a day

## В конце дня необходимо:
C: Close day
E: Day closed
E: Balance changed(employee, amount, current)
A: Day completed
EXT: cron

### считать сколько денег сотрудник получил за рабочий день
M: employee: balance: a day

### отправлять на почту сумму выплаты.
C: Send report
A: Day closed
E: Report sent

## После выплаты баланса (в конце дня) он должен обнуляться, и в аудитлоге всех операций аккаунтинга должно быть отображено, что была выплачена сумма.
P: employee:payment

## Дашборд должен выводить информацию по дням, а не за весь период сразу.
a) вообще хватит только за сегодня (всё равно попуги дальше не помнят), но если чувствуете, что успеете сделать аналитику за каждый день недели — будет круто
M: employee: payment: a day

# Аналитика

## Аналитика — это отдельный дашборд
Q: analytics-dashboard
A: roles: admin
##  Аналитика доступный только админам.

## Нужно указывать, сколько заработал топ-менеджмент за сегодня и сколько попугов ушло в минус.
C: Update stats
A: Prices set
E: Stats updated


## Нужно показывать самую дорогую задачу за день, неделю или месяц.
a) самой дорогой задачей является задача с наивысшей ценой из списка всех закрытых задач за определенный период времени

b) пример того, как это может выглядеть:

03.03 — самая дорогая задача — 28$
02.03 — самая дорогая задача — 38$
01.03 — самая дорогая задача — 23$
01-03 марта — самая дорогая задача — 38$
